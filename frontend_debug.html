<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frontend API Debug Tool</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; background-color: #f9f9f9; }
        button { padding: 10px 20px; margin: 5px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #45a049; }
        textarea { width: 100%; height: 200px; font-family: monospace; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>Frontend API Debug Tool</h1>
    
    <div class="debug-section">
        <h3>1. Test Backend Connectivity</h3>
        <button onclick="testBackendConnectivity()">Test Backend Health</button>
        <div id="connectivity-result"></div>
    </div>

    <div class="debug-section">
        <h3>2. Test Chat Sessions List</h3>
        <button onclick="testChatSessions()">Get Chat Sessions</button>
        <div id="sessions-result"></div>
    </div>

    <div class="debug-section">
        <h3>3. Test Send Message</h3>
        <input type="text" id="session-id" placeholder="Session ID" value="65eb6be8-048c-4b5e-842e-231023b4cfbc" style="width: 300px;">
        <input type="text" id="message-content" placeholder="Message content" value="Frontend debug test message" style="width: 300px;">
        <button onclick="testSendMessage()">Send Message</button>
        <div id="message-result"></div>
    </div>

    <div class="debug-section">
        <h3>Debug Log</h3>
        <textarea id="debug-log" readonly></textarea>
        <button onclick="clearLog()">Clear Log</button>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8000';
        
        function log(message) {
            const debugLog = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            debugLog.value += `[${timestamp}] ${message}\n`;
            debugLog.scrollTop = debugLog.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            document.getElementById('debug-log').value = '';
        }

        async function makeRequest(endpoint, options = {}) {
            const url = `${API_BASE_URL}${endpoint}`;
            log(`Making request to: ${url}`);
            log(`Options: ${JSON.stringify(options, null, 2)}`);
            
            try {
                const response = await fetch(url, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });
                
                log(`Response status: ${response.status} ${response.statusText}`);
                log(`Response headers: ${JSON.stringify(Object.fromEntries(response.headers.entries()), null, 2)}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                log(`Response data: ${JSON.stringify(data, null, 2)}`);
                
                return { success: true, data };
            } catch (error) {
                log(`Error: ${error.message}`);
                return { success: false, error: error.message };
            }
        }

        async function testBackendConnectivity() {
            log('=== Testing Backend Connectivity ===');
            const result = await makeRequest('/health');
            
            const resultDiv = document.getElementById('connectivity-result');
            if (result.success) {
                resultDiv.innerHTML = '<span class="success">✅ Backend is reachable</span>';
            } else {
                resultDiv.innerHTML = `<span class="error">❌ Backend connectivity failed: ${result.error}</span>`;
            }
        }

        async function testChatSessions() {
            log('=== Testing Chat Sessions API ===');
            const result = await makeRequest('/api/chat/sessions');
            
            const resultDiv = document.getElementById('sessions-result');
            if (result.success) {
                resultDiv.innerHTML = `<span class="success">✅ Got ${result.data.length} chat sessions</span>`;
            } else {
                resultDiv.innerHTML = `<span class="error">❌ Failed to get chat sessions: ${result.error}</span>`;
            }
        }

        async function testSendMessage() {
            const sessionId = document.getElementById('session-id').value;
            const content = document.getElementById('message-content').value;
            
            if (!sessionId || !content) {
                alert('Please enter both session ID and message content');
                return;
            }
            
            log('=== Testing Send Message API ===');
            const result = await makeRequest(`/api/chat/sessions/${sessionId}/messages`, {
                method: 'POST',
                body: JSON.stringify({ content })
            });
            
            const resultDiv = document.getElementById('message-result');
            if (result.success) {
                resultDiv.innerHTML = `<span class="success">✅ Message sent successfully</span>`;
            } else {
                resultDiv.innerHTML = `<span class="error">❌ Failed to send message: ${result.error}</span>`;
            }
        }

        // Initial log
        log('Frontend Debug Tool loaded');
        log(`API Base URL: ${API_BASE_URL}`);
    </script>
</body>
</html>
